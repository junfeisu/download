#!/usr/bin/env node

const program = require('commander')
const exec = require('child_process').exec
const path = require('path')

console.log('test')

program
  .version('1.0.0')

program
  .command('sd <dir>')
  .option('-u, --url <string>', '设置需要下载的文件的地址')
  .option('-d, --dest <string>', '设置下载文件存放的地址')
  .description('download the file')
  .action((dir) => {
    console.log('action')
    let command = 'node index.js -p ' + path.resolve(process.env.PWD, dir) + ' '

    if (program.url) {
      command += '-u ' + program.url + ' '
    }

    if (program.dest) {
      command += '-d ' + program.dest + ' '
    }

    console.log(command)

    exec(command.trim(), {'cwd': path.resolve(process.env.PWD)}, (err, stdout, stderr) => {
      if (err) {
        console.log('exec err is ', err)
      } else {
        console.log('stdout is ', stdout)
      }
    })
  })

program.parse(process.argv)
